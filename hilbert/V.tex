% V.tex â€” Verification Tensor: Proof-Enforcing Contract for G1S
% This revision upgrades the G1 harness from proof sketches to full proofs.
% It does so by: (i) tightening the module contract, (ii) adding explicit
% proof obligations, and (iii) providing a complete, reference proof of G1.
% All shared symbols are guarded with \providecommand to avoid overriding globals.

\documentclass[12pt]{article}

% ===== Packages (minimal, non-invasive) =====
\usepackage[T1]{fontenc}
\usepackage[utf8]{inputenc}
\usepackage{lmodern}
\usepackage{geometry}
\geometry{margin=1in}
\usepackage{amsmath,amssymb,amsthm}
\usepackage{mathtools}
\usepackage{enumitem}
\usepackage{microtype}
\usepackage{hyperref}
\hypersetup{colorlinks=true, linkcolor=black, urlcolor=blue, citecolor=blue}

% ===== Guarded shared symbols (safe fallbacks only) =====
% Causal set / order
\providecommand{\C}{\mathcal{C}}
\providecommand{\E}{\mathcal{E}}
\providecommand{\Vset}{\mathcal{V}}
\providecommand{\preceq}{\leq}

% Universe / tensors / operators
\providecommand{\U}{\mathbf{U}}
\providecommand{\T}{\mathbf{T}}
\providecommand{\Ek}{\mathbf{E}_k}
\providecommand{\grad}{\nabla}

% State/sample space and counting
\providecommand{\OmegaSet}{\Omega}
\DeclareMathOperator{\Dist}{Dist}

% Entropy notation (avoid \S which is section symbol)
\providecommand{\Entropy}{\mathrm{S}}
% Make \Entropy accept an optional subscript so \Entropy[\pi] is S_{\pi}
\makeatletter
\let\EntropySymbol\Entropy
\renewcommand{\Entropy}[1][]{\EntropySymbol_{\kern0.05em #1}}
\makeatother

% Monotonicity shorthand and visual tag
\providecommand{\Monotone}{\Delta\,\Entropy \ge 0}
\providecommand{\FixedPoint}{\mathsf{FP}}

% ===== Local theorem styles =====
\theoremstyle{plain}
\newtheorem{theorem}{Theorem}
\newtheorem{lemma}[theorem]{Lemma}
\newtheorem{proposition}[theorem]{Proposition}
\theoremstyle{definition}
\newtheorem{definition}[theorem]{Definition}
\theoremstyle{remark}
\newtheorem{remark}[theorem]{Remark}

% ===== Gold Check harness (generic) =====
\newcounter{goldcheck}
\newenvironment{goldcheck}[1][]{%
  \refstepcounter{goldcheck}%
  \par\medskip\noindent\textbf{Gold Check G\thegoldcheck. #1}\par\smallskip\noindent
  \begin{enumerate}[leftmargin=2.2em,label=\arabic*.]
}{%
  \end{enumerate}\medskip
}
\newcommand{\gpass}{\textbf{[PASS]}}
\newcommand{\gfail}{\textbf{[FAIL]}}

% ===== NEW: Proof Obligation environment =====
% Authors of G1S must explicitly exhibit the structure that makes the inequality hold.
% This mirrors ``witness'' style proofs in constructive mathematics.
\newenvironment{proofobligation}[1][]{%
  \par\medskip\noindent\textbf{Proof Obligation.} #1\;\emph{(Provide concrete witnesses and verifications.)}%
  \begin{enumerate}[leftmargin=2.2em,label=\alph*.]
}{%
  \end{enumerate}\medskip
}

\begin{document}
\pagenumbering{arabic}
\thispagestyle{plain}

\section*{V: Proof-Enforcing Contract for G1S (Monotone Entropy)}
\noindent\textit{Purpose.} This V layer converts all prior ``proof sketches'' in G1S into full, verification-grade proofs by (i) tightening interface assumptions, (ii) requiring explicit witnesses (injections) that justify monotonicity, and (iii) supplying a complete reference proof of $\Monotone$ that G1S may cite and specialize.

\section{Purpose and Scope}
The V layer defines the \emph{module contract} for G1S and a minimal test harness (Gold Checks). The contract pins down:
\begin{itemize}[leftmargin=2.2em]
  \item the refinement relation on causal structures;
  \item the observable/quotient used to count distinctions;
  \item explicit proof obligations (witness maps) for monotonicity; and
  \item a checklist for pass/fail marking without touching global macros in \texttt{P\_clean.tex}.
\end{itemize}
All shared macros in this file are wrapped in \verb|\providecommand|; if names already exist in \texttt{P\_clean.tex}, they are left untouched.

\section{Module Contract for G1S}
\subsection{Causal Refinements}
\begin{definition}[Causal Refinement]\label{def:refinement}
Let $(\C,\preceq)$ be a locally finite partial order. A \emph{refinement} is an order-embedding $\phi:\C\to\C'$ into another locally finite poset $(\C',\preceq')$ whose image is order-isomorphic to $\C$ and whose extension preserves local finiteness. We write $(\C,\preceq)\xrightarrow{\;\mathrm{ref}\;}(\C',\preceq')$.
\end{definition}

\begin{remark}[Local Finiteness and Martin-Consistency]\label{rem:martin}
Local finiteness ensures finite causal intervals. Martin-consistency asserts that the extension does not introduce contradictions with the partial order axioms nor violate local finiteness assumptions used elsewhere. This remark functions as a \emph{named assumption} that G1S must cite where used.
\end{remark}

\subsection{Observable and Quotient Stability}
\begin{definition}[Observable Compatibility]\label{def:observable}
An \emph{observable} is a map $\pi:\C\to\OmegaSet$ inducing an equivalence relation $x\sim y\iff \pi(x)=\pi(y)$. We say $\pi$ is \emph{compatible with} a refinement $\phi:\C\to\C'$ if there exists $\pi':\C'\to\OmegaSet$ such that $\pi'\circ \phi=\pi$ and $\pi'$ does not identify previously distinct equivalence classes of $\pi$ on $\phi(\C)$ (i.e., $\pi(x)\neq \pi(y)\Rightarrow \pi'(\phi(x))\neq \pi'(\phi(y))$).
\end{definition}

\begin{definition}[Entropy as Distinguishable Count]\label{def:entropy}
Given $\pi$, let $\OmegaSet(\C):=\C/\!\sim$ be the set of $\pi$-equivalence classes. Define
\[
  \Entropy[\pi](\C) := \ln\,\bigl\lvert\,\OmegaSet(\C)\,\bigr\rvert .
\]
\end{definition}

\subsection{Explicit Proof Obligations (Witness Form)}
Every claim of $\Monotone$ in G1S must provide concrete witnesses:
\begin{proofobligation}[for $\Delta\Entropy\ge 0$ under $\phi$]
  \item \textbf{Compatibility:} Exhibit $\pi'$ with $\pi'\circ\phi=\pi$ (Def.~\ref{def:observable}).
  \item \textbf{Injection on Classes:} Define $\iota:\OmegaSet(\C)\hookrightarrow \OmegaSet(\C')$ by $[x]\mapsto [\phi(x)]$ and verify well-definedness and injectivity.
  \item \textbf{Monotone Count:} Conclude $\lvert\OmegaSet(\C)\rvert\le \lvert\OmegaSet(\C')\rvert$ and hence $\Delta\Entropy\ge 0$.
\end{proofobligation}

\section{Reference Proofs (to be cited by G1S)}
\begin{lemma}[Class Injection under Compatible Refinement]\label{lem:injection}
Let $\phi:\C\to\C'$ be a refinement (Def.~\ref{def:refinement}) and $\pi,\pi'$ observables with $\pi'\circ\phi=\pi$ and compatibility as in Def.~\ref{def:observable}. Then the map
\[
  \iota:\OmegaSet(\C)\to \OmegaSet(\C'),\qquad \iota([x]) := [\phi(x)]
\]
is well-defined and injective.
\end{lemma}
\begin{proof}
\emph{Well-definedness:} If $[x]=[y]$ in $\OmegaSet(\C)$, then $\pi(x)=\pi(y)$. Applying $\pi'\circ\phi=\pi$ yields $\pi'(\phi(x))=\pi'(\phi(y))$, so $[\phi(x)]=[\phi(y)]$ in $\OmegaSet(\C')$.

\emph{Injectivity:} Suppose $\iota([x])=\iota([y])$, i.e., $[\phi(x)]=[\phi(y)]$ in $\OmegaSet(\C')$. Then $\pi'(\phi(x))=\pi'(\phi(y))$. By compatibility, previously distinct classes are not identified on $\phi(\C)$; therefore $\pi(x)=\pi(y)$, implying $[x]=[y]$.
\end{proof}

\begin{theorem}[G1: Monotonicity of Causal Entropy]\label{thm:monotone}
Under a compatible refinement $\phi:\C\to\C'$ (Defs.~\ref{def:refinement},\,\ref{def:observable}), we have
\[
  \Entropy[\pi'](\C') - \Entropy[\pi](\C) \;\ge\; 0.
\]
\end{theorem}
\begin{proof}
By Lemma~\ref{lem:injection}, $\iota:\OmegaSet(\C)\hookrightarrow \OmegaSet(\C')$ is injective, so $\lvert\OmegaSet(\C)\rvert\le \lvert\OmegaSet(\C')\rvert$. Taking logarithms proves the claim.
\end{proof}

\begin{remark}[Where Monotonicity Can Fail]\label{rem:fail}
If $\pi'$ identifies previously distinct $\pi$-classes on $\phi(\C)$, or if $\phi$ is not an order-embedding, Lemma~\ref{lem:injection} may fail and so can monotonicity. Such cases are outside the G1S contract and must be rejected by V.
\end{remark}

\section{Gold Checks: G1 Harness (Proof-Enforcing)}
The following checklist operationalizes the G1 requirement. G1S must include an instance of this environment at the end of each example or lemma that claims $\Monotone$.

\newenvironment{GOneSpec}{\begin{goldcheck}[Monotone Entropy ($\Delta\Entropy \ge 0$)]}{\end{goldcheck}}

\begin{GOneSpec}
  \item \gpass\; \textbf{Interface}: Symbols used appear in the guarded set or are locally defined (cf. this file).
  \item \gpass\; \textbf{Refinement}: Map $\phi$ is an order-embedding and Martin-consistent (Def.~\ref{def:refinement}).
  \item \gpass\; \textbf{Observable}: Provide $\pi'$ with $\pi'\circ\phi=\pi$ and show compatibility (Def.~\ref{def:observable}).
  \item \gpass\; \textbf{Witness}: Exhibit the class injection $\iota([x])=[\phi(x)]$ and verify Lemma~\ref{lem:injection} locally.
  \item \gpass\; \textbf{Claim}: Deduce $\Entropy[\pi'](\C')-\Entropy[\pi](\C)\ge 0$ from the cardinality inequality.
  \item \gpass\; \textbf{Edge Cases}: Rule out ties/merges that would violate compatibility (Remark~\ref{rem:fail}).
\end{GOneSpec}

\section{Verification Loop (Non-Invasive)}
To keep \texttt{P\_clean.tex} unchanged, V enforces the following loop on any candidate G1S revision:
\begin{enumerate}[leftmargin=2.2em]
  \item \textbf{Interface Freeze}: Reject any revision that changes global proof macros or symbols outside the guarded layer.
  \item \textbf{Refinement Legality}: Verify $\phi$ satisfies Def.~\ref{def:refinement}, including Martin-consistency.
  \item \textbf{Observable Lock}: Confirm observable compatibility (Def.~\ref{def:observable}).
  \item \textbf{Witness Check}: Require an explicit $\iota$ and verification of Lemma~\ref{lem:injection}.
  \item \textbf{Monotone Check}: Compute $\lvert\OmegaSet(\C)\rvert \le \lvert\OmegaSet(\C')\rvert$ and hence $\Monotone$.
\end{enumerate}

\section{Worked Example (Template for G1S)}
\noindent\textbf{Setup.} Let $\phi:\C\to\C'$ be a refinement adding events that further distinguish previously tied outcomes under a fixed sensor model $\pi$; define $\pi'$ by precomposition with $\phi$ on $\phi(\C)$ and arbitrary extension on $\C'\setminus\phi(\C)$ consistent with the sensor model.

\begin{proofobligation}
  \item \emph{Compatibility:} Define $\pi'$ on $\phi(\C)$ via $\pi'\circ\phi=\pi$.
  \item \emph{Injection:} $\iota([x])=[\phi(x)]$ is well-defined and injective by Lemma~\ref{lem:injection}.
  \item \emph{Monotone Count:} Conclude $\Delta\Entropy\ge 0$ and record the result in a local \texttt{GOneSpec} block.
\end{proofobligation}

\begin{GOneSpec}
  \item \gpass\; Interface: only guarded or local symbols used.
  \item \gpass\; Refinement: $\phi$ is an order-embedding (Def.~\ref{def:refinement}).
  \item \gpass\; Observable: $\pi'\circ\phi=\pi$; compatibility holds (Def.~\ref{def:observable}).
  \item \gpass\; Witness: $\iota([x])=[\phi(x)]$ is injective.
  \item \gpass\; Claim: $\Entropy[\pi'](\C')-\Entropy[\pi](\C)\ge 0$.
  \item \gpass\; Edge cases: none; no merges of previously distinct classes.
\end{GOneSpec}

\section{Fixed Point and Reporting}
When the G1 harness passes across all declared examples and lemmas, declare a local fixed point (tag $\FixedPoint$) for G1. Any failure voids the fixed point and must be rejected until the contract is re-satisfied.

\section*{Implementation Notes}
\begin{itemize}[leftmargin=2.2em]
  \item This file intentionally \emph{does not} redefine global macros in \texttt{P\_clean.tex}; symbols here are optional fallbacks via \verb|\providecommand|.
  \item G1S may add locally-scoped macros within its own file; V only checks interface and claims.
  \item If G1S needs additional symbols, prefer local definitions or submit a guarded addition to this file.
\end{itemize}

\end{document}
