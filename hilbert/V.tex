\
\documentclass[12pt]{article}
\usepackage[margin=1in]{geometry}
\usepackage{amsthm,amssymb,amsmath,mathtools}
\usepackage{enumitem}
\usepackage{booktabs}
\usepackage{xparse}
\usepackage{etoolbox}
\usepackage{hyperref}
\usepackage[nameinlink,capitalise]{cleveref}
\usepackage{algorithm}
\usepackage{algpseudocode}

\hypersetup{colorlinks=true, linkcolor=blue, urlcolor=blue, citecolor=blue}

% --- Theorem environments and macros ---
\newtheorem{theorem}{Theorem}
\newtheorem{definition}{Definition}
\newtheorem{proposition}{Proposition}
\newtheorem{lemma}{Lemma}
\newtheorem{remark}{Remark}

% --- Core symbols (shared with P_clean/G1S/G2S) ---
\newcommand{\U}{\mathbf{U}}        % Universe / admissible history (kinematics)
\newcommand{\Vt}{\mathbf{V}}       % Test function / variation
\newcommand{\Acal}{\mathcal{A}}    % Action / functional (informational curvature)
\newcommand{\Bform}{\mathsf{B}}    % Symmetric bilinear form (reciprocity)
\newcommand{\Hspace}{\mathcal{H}}  % Function space (e.g., H^2)
\newcommand{\Op}{\mathcal{L}}      % Generic operator
\newcommand{\R}{\mathbb{R}}
\newcommand{\norm}[1]{\left\lVert #1 \right\rVert}
\newcommand{\ip}[2]{\left\langle #1,\, #2 \right\rangle}

% --- Computable Tagging Layer (metadata for external parser) ---
% The following macros emit structured comments parsable by a script.
% Lines starting with `%%!` are machine-readable tags; keep the format stable.
\makeatletter
\newcommand{\VTAG}[1]{%%!#1}
\NewDocumentCommand{\DeclSymbol}{m m m}{%
  % #1 macro token (e.g., \U), #2 canonical name, #3 prose description
  \VTAG{SYMBOL: macro=\detokenize{#1}; name={#2}; desc={#3}}%
}
\NewDocumentCommand{\Unit}{m m m O{} o}{%
  % #1 type (Premise|Definition|Lemma|Theorem|Claim|Figure|Eq|Example|Remark)
  % #2 id (stable identifier, e.g., G2.Def)
  % #3 title (short)
  % #4 depends (csv of ids) [optional]
  % #5 labels (csv of LaTeX labels) <optional>
  \par\medskip\noindent{\bfseries #1~[\texttt{#2}].}~#3%
  \par\smallskip
  \VTAG{UNIT: type=#1; id=#2; depends={#4}; labels={#5}}%
}
\NewDocumentCommand{\Depends}{m}{\VTAG{DEPENDS: ids={#1}}}
\NewDocumentCommand{\NeedsCite}{m}{\VTAG{CITE-OBLIGATION: for={#1}}}
\NewDocumentCommand{\Anchors}{m}{\VTAG{ANCHORS: labels={#1}}}
\NewDocumentCommand{\SymbolUse}{m}{\VTAG{SYMBOL-USE: tokens=\detokenize{#1}}}
\makeatother

% --- Notation table helper (human + machine) ---
\NewDocumentCommand{\SymbolRow}{m m m}{% macro, name, description
  \DeclSymbol{#1}{#2}{#3}\\
  \texttt{\string#1} & #2 & #3 \\
}

% --- Verification Residual Channels ---
\NewDocumentCommand{\LogicResidual}{m}{\VTAG{RESIDUAL-LOGIC: edge=#1}}
\NewDocumentCommand{\StructureResidual}{m}{\VTAG{RESIDUAL-STRUCT: rule=#1}}
\NewDocumentCommand{\NotationResidual}{m}{\VTAG{RESIDUAL-NOTATION: rule=#1}}
\NewDocumentCommand{\CitationResidual}{m}{\VTAG{RESIDUAL-CITATION: unit=#1}}

% --- Gold-check anchors (V expects these labels to exist) ---
% G1: Delta S >= 0; G2: D^4 U = 0; G3: Spline -> Euler-Lagrange; G4: Reciprocity; G5: MA <-> Continuity
\newcommand{\GOneDef}{G1.Def}
\newcommand{\GTwoDef}{G2.Def}
\newcommand{\GTwoWeak}{G2.Weak}
\newcommand{\GTwoBC}{G2.BC}
\newcommand{\GTwoRecip}{G2.Recip}
\newcommand{\GTwoKernel}{G2.Kernel}
\newcommand{\GTwoDiscCons}{G2.DiscCons}
\newcommand{\GThreeChain}{G3.Chain}
\newcommand{\GFourFunc}{G4.Func}
\newcommand{\GFiveBoundary}{G5.Boundary}

% --- Document ---
\begin{document}

\begin{center}
{\Large \textbf{V.tex: The Verification Tensor}}\\[4pt]
{\large A Jacobian-Free Newton--Krylov (JFNK) Specification for Manuscript Verification}\\[4pt]
\textit{October 13, 2025}
\end{center}

\begin{abstract}
This document defines a \emph{computable} verifier $V$ for a research manuscript $P$.
We formalize $V$ as a nonlinear system $F(x)=0$ over a finite state vector of document units (claims, lemmas, definitions, equations, figures, citations) with an explicit, machine-parsable dependency graph. We decompose residuals into four orthogonal channels (logic, structure, notation, citation), minimize a weighted norm, and solve the Newton step via a Jacobian-Free Newton--Krylov (JFNK) method with block preconditioning, eigenmode deflation, and a trust-region edit budget. Hard constraints (\emph{gold checks}) enforce correctness on five pillars: $\Delta S \ge 0$ (G1), kinematic closure $D^4\U=0$ (G2), the spline$\Rightarrow$Euler--Lagrange chain (G3), reciprocity/variational form (G4), and a clearly delimited MA$\leftrightarrow$continuity boundary (G5).
\end{abstract}

\section{State, Residual, and Objective}
\Unit{Definition}{State.Vector}{Document state and residual channels}[~]{sec:state}
Let the manuscript state be $x \in \R^n$, encoding a finite set of units with stable identifiers and a sparse dependency DAG. The verifier maps $x$ to residuals
\begin{equation}
F(x) =
\begin{bmatrix}
r_{\mathrm{logic}}(x)\\
r_{\mathrm{struct}}(x)\\
r_{\mathrm{notation}}(x)\\
r_{\mathrm{cite}}(x)
\end{bmatrix}\in\R^{m_\ell+m_s+m_n+m_c}.
\end{equation}
We minimize a composite norm with logical dominance
\begin{equation}
\label{eq:norm}
\|F(x)\| = 10\,\|r_{\mathrm{logic}}(x)\|_2 + 4\,\|r_{\mathrm{struct}}(x)\|_2 + 3\,\|r_{\mathrm{notation}}(x)\|_2 + 2\,\|r_{\mathrm{cite}}(x)\|_2 .
\end{equation}

\subsection*{Channel Models (Engineering Forms)}
\paragraph{Logic.}
Let $B\in\R^{E\times V}$ be the incidence matrix of the premise$\to$claim DAG and $s_i \in [0,1]$ a satisfaction score for premise $i$ (1=stated+proved, 0=missing).
For each edge $(i\to j)$ with threshold $\tau\in(0,1]$,
\begin{equation}
r^{(i\to j)}_{\mathrm{logic}}(x)=\max(0,\,\tau - s_i).
\end{equation}
\LogicResidual{$i\to j$}

\paragraph{Structure.}
Let $A_{\mathrm{struct}}x=b$ encode templating constraints (e.g., Theorem$\to$Proof$\to$Corollary, no orphan theorems).
Define $r_{\mathrm{struct}}(x)=A_{\mathrm{struct}}x-b$.
\StructureResidual{A\_struct x = b}

\paragraph{Notation.}
Given a symbol table $T$, for symbol $\sigma\in T$ let $P_\sigma$ project $x$ onto uses of $\sigma$ and $t_\sigma$ be the canonical anchor (definition+scope). With weights $W_\sigma\succ0$,
\begin{equation}
r_{\mathrm{notation}}(x)=\sum_{\sigma\in T} W_\sigma\left(P_\sigma x - t_\sigma\right).
\end{equation}
\NotationResidual{symbol unification via anchors}

\paragraph{Citation.}
For obligations $Cx+\xi\ge d$ with slacks $\xi\ge 0$ (one inequality per claim that requires a cite), define
\begin{equation}
r_{\mathrm{cite}}(x)=\xi,\qquad \xi=\max(0,\,d-Cx)~\text{(elementwise)}.
\end{equation}
\CitationResidual{per-claim inequality obligations}

\section{JFNK Solver with Finite-Difference Actions}
\Unit{Definition}{JFNK.Step}{Jacobian-free Newton step with Krylov solver}[State.Vector]{sec:jfnk}
We seek $\delta x$ solving $J(x)\,\delta x = -F(x)$. We do not form $J$; we approximate actions by directional differencing. For any $v$,
\begin{equation}
J(x)v \approx \frac{F(x+\varepsilon v)-F(x)}{\varepsilon},\qquad \varepsilon=\varepsilon_0\,\frac{1+\|x\|^2}{1+\|v\|^2},\quad \varepsilon_0\in[10^{-6},10^{-4}].
\end{equation}

\begin{algorithm}
\caption{One JFNK Outer Iteration with Trust Region and Deflation}
\begin{algorithmic}[1]
\Require state $x$, tolerance $\tau$, max Krylov $m$, restart $m_r$, step cap $\alpha_{\max}$
\State $r \gets F(x)$; \textsc{Deflate}$(r)$
\State Solve $J(x)\delta x = -r$ with (F)GMRES using actions above and right preconditioner $M^{-1}$
\State Choose $\alpha\in(0,\alpha_{\max}]$ by ratio test $\rho = \dfrac{\|r\|-\|F(x+\alpha\delta x)\|}{\text{model decrease}}$
\If{$\rho<\rho_{\min}$} \State $\alpha\gets \alpha/2$ and retry (few cuts) \EndIf
\State $x^+\gets x+\alpha\,\delta x$; \Return $x^+$
\end{algorithmic}
\end{algorithm}

\section{Preconditioning and Deflation}
\Unit{Definition}{Block.Precond}{Block right-preconditioner by channel}[JFNK.Step]{sec:precond}
Use block-diagonal $M^{-1}\approx\mathrm{diag}(M^{-1}_\ell,M^{-1}_s,M^{-1}_n,M^{-1}_c)$ where
\begin{itemize}[leftmargin=2em]
\item $M^{-1}_\ell$: premise fill (promote/demote nodes to restore DAG), cycle break;
\item $M^{-1}_s$: template normalization, duplicate squash;
\item $M^{-1}_n$: symbol unification (single-source-of-truth macros), conflict renames;
\item $M^{-1}_c$: obvious Bib\TeX{} fixes; otherwise mark needs-cite.
\end{itemize}

\Unit{Definition}{Deflation}{Eigenmode deflation of solved residual shapes}[JFNK.Step]{sec:deflate}
Maintain $\{q_i\}$; project out of residuals and Krylov vectors:
\begin{equation}
r\leftarrow r-\sum_i \frac{\ip{r}{q_i}}{\ip{q_i}{q_i}}\,q_i,\qquad
v\leftarrow v-\sum_i \frac{\ip{v}{q_i}}{\ip{q_i}{q_i}}\,q_i.
\end{equation}

\section{Trust Region and Edit Budget}
\Unit{Definition}{Trust.Region}{Ratio test and bounded edit budget}[JFNK.Step]{sec:trust}
Accept $x^+=x+\alpha\,\delta x$ with $\alpha$ from the ratio test. Impose a per-iteration edit budget (default: $\le 2\%$ token change; at most one theorem moved).

\section{Gold Checks (Hard Constraints)}
\Unit{Definition}{Gold.Checks}{Five hard constraints for acceptance}[State.Vector]{sec:gold}
These must pass:
\begin{enumerate}[label=G\arabic*., leftmargin=2em]
\item \textbf{(\GOneDef)} Formal statement and scope of $\Delta S\ge 0$ via discrete causal counting; no hidden thermodynamic assumptions.
\item \textbf{(\GTwoDef, \GTwoWeak, \GTwoBC, \GTwoRecip, \GTwoKernel, \GTwoDiscCons)} Kinematic closure $D^4\U=0$ appears once, with weak form, clamped boundary conditions, reciprocity proof (symmetry, boundedness, coercivity), kernel noted and eliminated by BCs, and a discrete-consistency lemma for splines.
\item \textbf{(\GThreeChain)} Spline $\Rightarrow$ Euler--Lagrange chain occurs once, cleanly.
\item \textbf{(\GFourFunc)} Reciprocity functional stated with correct variational form and boundary terms; no sign inconsistencies.
\item \textbf{(\GFiveBoundary)} MA$\leftrightarrow$continuity boundary clearly delimited; set-theoretic heuristics are meta-assumptions, not proof steps.
\end{enumerate}
\Anchors{\GOneDef,\GTwoDef,\GTwoWeak,\GTwoBC,\GTwoRecip,\GTwoKernel,\GTwoDiscCons,\GThreeChain,\GFourFunc,\GFiveBoundary}

\section{Stopping Criteria and Acceptance}
\Unit{Definition}{Stop.Criteria}{Convergence and acceptance conditions}[Gold.Checks]{sec:stop}
Stop when: (i) $\|F(x)\|\le \tau$ for \eqref{eq:norm}; (ii) all gold checks pass; (iii) logic channel empty; (iv) last accepted step $\alpha=1$ or Krylov stagnates with negligible residual.

\section{Audit Trail (Deterministic Handoff to P)}
\Unit{Definition}{Audit.Trail}{Per-iteration artifacts for reproducibility}[Stop.Criteria]{sec:audit}
Each iteration emits: (1) channel-wise residual summary and norms; (2) ranked findings with suggested local edits (preconditioner actions flagged); (3) updated deflation set $\{q_i\}$; (4) accepted step size $\alpha$ and observed decrease.

\section{Computable Interface to \texorpdfstring{\texttt{P\_clean.tex}}{} and Gold Specs}
\Unit{Definition}{Interface.Macros}{Tagging macros and anchors exposed to the parser}[Audit.Trail]{sec:iface}

\subsection*{Symbol Table (human + machine)}
\begin{center}
\begin{tabular}{@{}lll@{}}
\toprule
\textbf{Macro} & \textbf{Name} & \textbf{Description}\\
\midrule
\SymbolRow{\U}{Universe Tensor}{Admissible history / kinematic field}\\
\SymbolRow{\Vt}{Test Function}{Virtual variation in weak form}\\
\SymbolRow{\Acal}{Action}{Informational curvature functional}\\
\SymbolRow{\Bform}{Bilinear Form}{Reciprocity form on $H^2_0$}\\
\SymbolRow{\Hspace}{Function Space}{$H^2(I)$ or subspace $H^2_0(I)$}\\
\bottomrule
\end{tabular}
\end{center}

\subsection*{Unit Declaration Examples (to be mirrored in \texttt{P\_clean.tex})}
\Unit{Definition}{\GTwoDef}{Kinematic closure $D^4\U=0$}[~][def:g2]
\Depends{~}
\SymbolUse{\U, D^4}
\Unit{Proposition}{\GTwoWeak}{Weak form $\Bform(\U,\Vt)=0$ for all $\Vt\in H^2_0(I)$}[\GTwoDef][prop:g2weak]
\Unit{Definition}{\GTwoBC}{Clamped boundary conditions eliminating kernel}[\GTwoDef][def:g2bc]
\Unit{Proposition}{\GTwoRecip}{Reciprocity: $\Bform$ symmetric, bounded, coercive}[\GTwoWeak, \GTwoBC][prop:g2recip]
\Unit{Remark}{\GTwoKernel}{Kernel of $D^4$ and its removal by BCs}[\GTwoDef][rem:g2kernel]
\Unit{Lemma}{\GTwoDiscCons}{Spline consistency/stability in $H^2$}[\GTwoWeak][lem:g2disc]

\smallskip
\noindent\textit{Note:} The lines printed by the macros above also emit machine-readable tags (prefixed by \texttt{%%!}) in the output stream, which a parser can consume to build the DAG and symbol/citation tables.

\subsection*{Optional Inclusion of Gold Specs}
Where available, the verifier can \emph{also} read the canonical gold-check sources to cross-validate anchors:
\begingroup\small
\noindent\texttt{\string\IfFileExists\string{G1S.tex\string}\string{\string\input\string{G1S.tex\string}\string}{\string\relax}}\\
\texttt{\string\IfFileExists\string{G2S.tex\string}\string{\string\input\string{G2S.tex\string}\string}{\string\relax}}
\endgroup

\section{Structural Rules (Template Constraints)}
\Unit{Definition}{Struct.Rules}{Linear placement constraints and exceptions}[Interface.Macros]{sec:struct}
Default rules:
\begin{enumerate}[label=\textbf{S\arabic*}, leftmargin=2em]
\item Each \emph{Theorem} must be followed by exactly one \emph{Proof} block. (\StructureResidual{T1-Proof1})
\item \emph{Definition} must precede first use of its symbol. (\StructureResidual{Def-Precedes-Use})
\item No orphan environments (every Theorem has a label; every label is referenced). (\StructureResidual{No-Orphans})
\end{enumerate}
\textbf{Allowed exceptions}: nested commentary within proofs is permitted; the preconditioner $M^{-1}_s$ normalizes but does not reject nested blocks.

\section{Notation Policy (Unification and Drift Control)}
\Unit{Definition}{Notation.Policy}{Single-source-of-truth macros and versioned meanings}[Struct.Rules]{sec:notation}
A single canonical definition per symbol is recorded in the symbol table. If meanings drift by context, assign a \emph{versioned} alias (e.g., \texttt{\string\UUniverse}, \texttt{\string\UOperator}) and add a human-facing note plus a machine tag via \SymbolUse.

\section{Citation Policy (Hard vs.\ Soft Attributions)}
\Unit{Definition}{Citation.Policy}{Inequality obligations and soft-citation tokens}[Notation.Policy]{sec:citation}
Claims requiring external support must satisfy an inequality obligation. Narrative attributions may use soft-citation tokens; these satisfy a weaker residual and are flagged for human review.

\section{Minimal Integration Steps}
\Unit{Remark}{Integration.Steps}{Four steps to wire $V$ into the build}[Citation.Policy]{sec:integrate}
(1) Add the tagging macros to \texttt{P\_clean.tex} units; (2) expose $F(\cdot)$ and the action oracle $v\mapsto J(x)v$ via the parser; (3) enable preconditioner blocks as local transforms; (4) enforce the edit budget and gold checks at accept time.

\end{document}
