\documentclass[12pt]{article}

% ---------------- Packages ----------------
\usepackage{amsthm,amssymb,amsmath,mathtools,setspace}
\usepackage{enumitem}
\usepackage{xcolor}
\onehalfspacing

% --------------- Version ------------------
\newcommand{\Vversion}{2025-10-13-min}

% ------ Theorem-like envs (guarded) -------
\makeatletter
\@ifundefined{theorem}{\newtheorem{theorem}{Theorem}}{}
\@ifundefined{definition}{\newtheorem{definition}{Definition}}{}
\@ifundefined{proposition}{\newtheorem{proposition}{Proposition}}{}
\makeatother

% --------- Shared symbols (guarded) -------
\providecommand{\U}{\mathbf{U}}        % field / history
\providecommand{\V}{\mathbf{V}}        % test / variation
\providecommand{\Acal}{\mathcal{A}}    % action
\providecommand{\Bform}{\mathsf{B}}    % bilinear form
\providecommand{\Hspace}{\mathcal{H}}  % trial space (e.g., H^2)
\providecommand{\Test}{\mathcal{V}}    % test space
\providecommand{\D}{\mathrm{D}}        % 1D derivative
\providecommand{\be}{\begin{equation}}
\providecommand{\ee}{\end{equation}}
\providecommand{\grad}{\nabla}

% Entropy (safe shorthands)
\providecommand{\Ent}{\mathrm{S}}
\newcommand{\DeltaEnt}{\Delta\Ent}

% Spline / mesh (lightweight)
\providecommand{\Spline}{\mathsf{S}}
\providecommand{\mesh}{h}

% ---- Minimal variational semantics -------
\providecommand{\AcalFunctional}[1]{\tfrac12 \int (\D^2 #1)^2\,dx}
\providecommand{\BformDef}[2]{\int (\D^2 #1)(\D^2 #2)\,dx}
\providecommand{\AcalOf}[1]{\AcalFunctional{#1}}
\providecommand{\Bof}[2]{\BformDef{#1}{#2}}

% ------------- vnode tagging --------------
\makeatletter
\@ifundefined{vnode}{
  \newcommand{\vnode}[2][]{%
    \begingroup
      \edef\@id{#1}\ifx\@id\@empty\def\@id{unnamed}\fi
      \expandafter\gdef\csname vnode@\@id\endcsname{}%
    \endgroup
    #2%
  }
}{}
\makeatother

% ----- Structural contract (warnings) -----
\makeatletter
\newcommand{\VRequireNode}[1]{%
  \@ifundefined{vnode@#1}{%
    \PackageWarning{V}{Missing required vnode id: `#1'. P_clean may be incomplete.}%
  }{}%
}
\newcommand{\VCheckPcleanStructure}{%
  \VRequireNode{abs}%
  \VRequireNode{overview}%
  \VRequireNode{chap:order}%
  \VRequireNode{chap:reciprocity}%
  \VRequireNode{chap:spline}%
  \VRequireNode{chap:conservation}%
  \VRequireNode{chap:entropy}%
  \VRequireNode{chap:ledger}%
}
\makeatother

% --------------- Document -----------------
\title{\textbf{V.tex â€” Minimal Verification Contract}\\
\large Keeps P\_clean correct without redefining it (V\Vversion)}
\author{V (compatibility layer)}
\date{\today}

\begin{document}
\maketitle

\section*{Purpose}
This minimal layer:
\begin{itemize}[leftmargin=2em]
  \item defines shared macros only if missing,
  \item pins two semantics used by \texttt{P\_clean}: entropy monotonicity and biharmonic closure,
  \item and warns if required structural anchors are missing.
\end{itemize}

\section{G1: Monotone Entropy (Contract)}
\begin{definition}[Observable Classes]
For a causal structure $\mathcal{C}$ and observable $\pi$, let $\Omega(\mathcal{C})$ be the induced equivalence classes. Define entropy $\Ent[\pi](\mathcal{C})=\ln|\Omega(\mathcal{C})|$ (units absorbed).
\end{definition}

\begin{definition}[Compatible Refinement]
A refinement $\phi:\mathcal{C}\!\to\!\mathcal{C}'$ is compatible if it is order-embedding and non-merging at the level of classes.
\end{definition}

\begin{proposition}[Injective Class Map]
Compatibility induces $\iota:\Omega(\mathcal{C})\to\Omega(\mathcal{C}')$, $\iota([x])=[\phi(x)]$, which is injective.
\end{proposition}

\begin{theorem}[Second Law (Minimal Form)]
For any compatible refinement, $\DeltaEnt=\Ent[\pi'](\mathcal{C}')-\Ent[\pi](\mathcal{C})\ge 0$.
\end{theorem}

\section{G2: Kinematic Closure (Contract)}
\begin{definition}[Action and Reciprocity]
For $\U\in\Hspace$ and $\V\in\Test$,
\[
  \Acal[\U]=\AcalOf{\U},\qquad
  \Bform(\U,\V)=\Bof{\U}{\V}.
\]
Stationarity of $\Acal$ gives the weak form $\Bform(\U,\V)=0$ for all $\V\in\Test$.
\end{definition}

\begin{theorem}[Biharmonic Strong Form]
Under appropriate BCs, stationarity implies the strong form $\D^{4}\U=0$.
\end{theorem}

\paragraph{Spline Consistency (notational hook).}
If $\U_{\mesh}$ is a discrete solution and $\Spline_{\mesh}$ a reconstruction, statements of the form
$\|\Spline_{\mesh}\U_{\mesh}-\U^\star\|\to 0$ as $\mesh\to 0$
are admissible and well-typed here.

\bigskip
% Run structure check late so P_clean has had a chance to set vnodes.
\VCheckPcleanStructure

\end{document}
